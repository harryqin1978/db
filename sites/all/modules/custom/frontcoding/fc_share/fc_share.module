<?php 

/**
* Implementation of hook_permission()
*/
function fc_share_permission() {

  return array(
    'admin share information' => array(
      'title' => t('admin share information'),
    ),
  );

}
/*
 * Implementation of hook_menu()
 * 
 * */
function fc_share_menu() {

  $items['admin/config/webmaster/fc_share'] = array(
    'title' => 'Share',
    'description' => 'Share management.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('fc_share_admin_information'),
    'access arguments' => array('Update Share Information'),
    'file' => 'fc_share.admin.inc',
  );
  return $items;

}





/**
 * Implements hook_block_info().
 *
 * This hook declares what blocks are provided by the module.
 */
function fc_share_block_info() {
  // This hook returns an array, each component of which is an array of block
  // information. The array keys are the 'delta' values used in other block
  // hooks.

  // The required block information is a block description, which is shown
  // to the site administrator in the list of possible blocks. You can also
  // provide initial settings for block weight, status, etc.

  // Many options are defined in hook_block_info():
  $blocks['fc_share_content'] = array(
    // info: The name of the block.
    'info' => t('Share Button'),
    // Block caching options (per role, per user, etc.)
    'cache' => DRUPAL_CACHE_PER_ROLE, // default
  );

  return $blocks;

}



/**
 * Implements hook_block_view().
 *
 * This hook generates the contents of the blocks themselves.
 */
function fc_share_block_view($delta = '') {
  //The $delta parameter tells us which block is being requested.
  switch ($delta) {
    case 'fc_share_content':
      // The subject is displayed at the top of the block. Note that it
      // should be passed through t() for translation. The title configured
      // for the block using Drupal UI supercedes this one.
      $block['subject'] = t('Share');
      // The content of the block is typically generated by calling a custom
      // function.
     // $block['content'] = "";
	//Sina Info
	$share_url =  'http://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI'];
	$sina_ico = variable_get('sina_ico');
	$sina_url = variable_get('sina_url');
	$sina_title = variable_get('sina_title');
	if (isset($sina_title) && $sina_title != 0){
		drupal_add_js('function sina(){
window.open("http://service.weibo.com/share/share.php?title="+location.href,"_blank","scrollbars=no,width=600,height=450,left=75,top=20,status=no,resizable=yes"); 
}','inline');
		
	if (isset($sina_ico) && $sina_ico != 0){
		$sina_ico_uri = file_load($sina_ico)->uri;	
		$picture = "<img src='".file_create_url($sina_ico_uri)."' width='104' height='25' alt=''>";
	}else {
		$picture = '<img  src="' . base_path() . drupal_get_path('module', 'fc_share') . '/images/share_sina.png' . '" width="104" height="25" alt="" />';
	}
	//echo $sina_ico;
	
	
	//$block['content'] = "<a target='_blank' href='http://service.weibo.com/share/share.php?title=".$sina_url."'></a>";
	$block['content'] = "<div class='fc-share-button-sina'><a href='javascript:void(0)' onclick='sina();return false;'target='_blank' class='tt' title=''>".$picture."</a></div><div class='fc-share-link-sina'><a target='_blank' href ='".$sina_url."'>".t('Our Sina Weibo')."</a></div>";
	}
	
	//Tencent Info
	$tencent_ico = variable_get('tencent_ico');
	$tencent_url = variable_get('tencent_url');
	$tencent_title = variable_get('tencent_title');	
	if (isset($tencent_title) && $tencent_title != 0){
		drupal_add_js('
	function postToWb(){
var _t = encodeURI(document.title);
var _url = encodeURIComponent(document.location);
var _appkey = encodeURI(\'\');//From tencent have appkey this can not fill, if have their own appkey may display their source display
var _pic = encodeURI(\'\');//
var _site = \'\';//Your website address, can blank
var _u = \'http://v.t.qq.com/share/share.php?url=\'+_url+\'&appkey=\'+_appkey+\'&site=\'+_site+\'&pic=\'+_pic+\'&title=\'+_t;
window.open( _u,\'\', \'width=700, height=680, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, location=yes, resizable=no, status=no\' );
};', 'inline');	
		
		
		if (isset($tencent_ico) && $tencent_ico != 0){
		$tencent_ico_uri = file_load($tencent_ico)->uri;	
		$picture = "<img src='".file_create_url($tencent_ico_uri)."' width='104' height='25' alt=''>";	
		}else {
			$picture = '<img  src="' . base_path() . drupal_get_path('module', 'fc_share') . '/images/share_tencent.png' . '" width="104" height="25" alt="" />';
			
		}
		$block['content'] .= "<div class='fc-share-button-tencent'><a href='javascript:void(0)' onclick='postToWb();return false;'target='_blank' class='tt' title=''>".$picture."</a></div><div class='fc-share-link-tencent'><a target='_blank' href='".$tencent_url."'>".t('Our Tencent Weibo')."</a></div>";	
		
		
	}
	
	//Kaixin Info
	$kaixin_ico = variable_get('kaixin_ico');
	$kaixin_url = variable_get('kaixin_url');
	$kaixin_title = variable_get('kaixin_title');	
	if(isset($kaixin_title) && $kaixin_title != 0){
		
		drupal_add_js('function kaixin(){
window.open("http://www.kaixin001.com/repaste/share.php?rurl="+location.href+"&rword="+location.href,"_blank","scrollbars=no,width=600,height=450,left=75,top=20,status=no,resizable=yes"); 
}','inline');
		
		if (isset($kaixin_ico) && $kaixin_ico !=0){
			$kaixin_ico_uri = file_load($kaixin_ico)->uri;
			$picture = "<img src='".file_create_url($tencent_ico_uri)."' width='104' height='25' alt=''>";	
		}else {
			$picture = '<img  src="' . base_path() . drupal_get_path('module', 'fc_share') . '/images/share_kaixin.png' . '" width="104" height="25" alt="" />';
		}
		
		$block['content'] .= "<div class='fc-share-button-kaixin'><a href='javascript:void(0)' onclick='kaixin();return false;'target='_blank' class='tt' title=''>".$picture."</a></div><div class='fc-share-link-kaixin'><a target='_blank' href='".$kaixin_url."'>".t('Our Kaixin')."</a></div>";	
		
		
	}
	//Renren Info
	$renren_ico = variable_get('renren_ico');
	$renren_url = variable_get('renren_url');
	$renren_title = variable_get('renren_title');	      
  if (isset($renren_title) && $renren_title != 0){
  
  	drupal_add_js('function renren()
{
   var s=window.screen;
   var d=document;
   var e=encodeURIComponent;

if(/renren\.com/.test(d.location))
   return;

window.open(\'http://www.connect.renren.com/share/sharer?url=\'+d.location,\'xnshare\',[\'toolbar=0,status=0,resizable=1,width=626,height=436,left=\',(s.width-626)/2,\',top=\',(s.height-436)/2].join(\'\'));

}','inline');
  	if (isset($renren_ico) && $renren_ico != 0){
			$renren_ico_uri = file_load($renren_ico)->uri;
			$picture = "<img src='".file_create_url($renren_ico_uri)."' width='104' height='25' alt=''>";  		
  	}else {
			$picture = '<img  src="' . base_path() . drupal_get_path('module', 'fc_share') . '/images/share_renren.png' . '" width="105" height="25" alt="" />';  	
  	}
  	
		$block['content'] .= "<div class='fc-share-button-renren'><a href='javascript:void(0)' onclick='renren();return false;'target='_blank' class='tt' title=''>".$picture."</a></div><div class='fc-share-link-renren'><a target='_blank' href='".$renren_url."'>".t('Our Renren')."</a></div>";
  	
  }

	//Linkedin Info
	$share_url =  'http://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI'];
	$linkedin_ico = variable_get('linkedin_ico');
	$linkedin_url = variable_get('linkedin_url');
	$linkedin_title = variable_get('linkedin_title');
	
	
  if (isset($linkedin_title) && $linkedin_title != 0){
 		drupal_add_js('function linkedin(){
window.open("http://www.linkedin.com/shareArticle?mini=true&url="+location.href+"&title="+location.href+"&source="+location.href,"_blank","scrollbars=no,width=600,height=450,left=75,top=20,status=no,resizable=yes"); 
}','inline');
  	
  	if (isset($linkedin_ico) && $linkedin_ico !=0){
			$linkdein_ico_uri = file_load($linkedin_ico)->uri;
			$picture = "<img src='".file_create_url($linkdein_ico_uri)."' width='104' height='25' alt=''>";    	
  	}else {
  		$picture = '<img  src="' . base_path() . drupal_get_path('module', 'fc_share') . '/images/share_linkedin.png' . '" width="104" height="25" alt="" />';
  	}
  	$block['content'] .=  "<div class='fc-share-button-linkedin'><a href='javascript:void(0)' onclick='linkedin();return false;'target='_blank' class='tt' title=''>".$picture."</a></div><div class='fc-share-link-linkedin'><a target='_blank' href='".$linkedin_url."'>".t('Our Linkedin')."</a></div>";;
  }

  //Twitter Info

	$twitter_ico = variable_get('twitter_ico');
	$twitter_url = variable_get('twitter_url');
	$twitter_title = variable_get('twitter_title');


  if (isset($twitter_title) && $twitter_title != 0){

 		drupal_add_js('function twitter(){
window.open("http://twitter.com/home?status="+location.href,"_blank","scrollbars=no,width=600,height=450,left=75,top=20,status=no,resizable=yes"); 
}','inline');
 
  	if (isset($twitter_ico) && $twitter_ico !=0){
			$twitter_ico_uri = file_load($twitter_ico)->uri;
			$picture = "<img src='".file_create_url($twitter_ico_uri)."' width='104' height='25' alt=''>";    	
  	}else {
  		$picture = '<img  src="' . base_path() . drupal_get_path('module', 'fc_share') . '/images/share_twitter.png' . '" width="104" height="25" alt="" />';
  	}
  	$block['content'] .=  "<div class='fc-share-button-twitter'><a href='javascript:void(0)' onclick='twitter();return false;'target='_blank' class='tt' title=''>".$picture."</a></div><div class='fc-share-link-twitter'><a target='_blank' href='".$twitter_url."'>".t('Our Twitter')."</a></div>";;
  }

  
  //Facebook Info

	$facebook_ico = variable_get('facebook_ico');
	$facebook_url = variable_get('facebook_url');
	$facebook_title = variable_get('facebook_title');

  if (isset($facebook_title) && $facebook_title != 0){
  	
 		drupal_add_js('function facebook(){
 		var _t = encodeURI(document.title);
 		
window.open("http://www.facebook.com/sharer.php?u="+location.href+"&t="+_t,"_blank","scrollbars=no,width=600,height=450,left=75,top=20,status=no,resizable=yes"); 
}','inline'); 	
 
  	
  	if (isset($facebook_ico) && $facebook_ico !=0){
			$facebook_ico_uri = file_load($twitter_ico)->uri;
			$picture = "<img src='".file_create_url($facebook_ico_uri)."' width='104' height='25' alt=''>";    	
  	}else {
  		$picture = '<img  src="' . base_path() . drupal_get_path('module', 'fc_share') . '/images/share_facebook.png' . '" width="104" height="25" alt="" />';
  	}
  	$block['content'] .=  "<div class='fc-share-button-facebook'><a href='javascript:void(0)' onclick='facebook();return false;'target='_blank' class='tt' title=''>".$picture."</a></div><div class='fc-share-link-facebook'><a target='_blank' href='".$facebook_url."'>".t('Our Facebook')."</a></div>";;
  }
      break;
      
      default:
     		 break;
  }

  return $block;
}